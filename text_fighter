import random
import sys
import time
import os

done = False
level = 1
hp = 450
healers = 10
score = 0
toaster_encounters = 0
enemy_hp = 100
# doesn't matter because it will change after, this is just to define enemy_hp
passcode = "OIOIOIGETMEIN"
enemies = ["Bed", "Toaster", "Sofa", "Lamp", "Car"]
spring = False
inventory = []
onlyonce = False
single = False

achievements = {
    "Bread Winner": False,      # defeat 5 food items
    "Crumby Death": False,      # encounter 5 toasters
    "Interior Decorator": False,# defeat a Bed, Sofa, and Lamp
    "Hoarder": False,           # 5+ items in inventory
    "The 89Pexel Special": False # name (you can never get it because you'll get sys.exit()'ed lol)
}

victory_messages = [
    "You showed that appliance who's boss!",
    "That'll teach it to look at you funny.",
    "Target neutralized. Cleaning crew requested.",
    "Another one bites the dust."
]

os.system(f"title Furniture Slayer - Score: {score}")

flavor_text = {
    "Toaster": [
        "It smells like burnt crumbs...",
        "A piece of charcoal pops out. It's aggressive.",
        "The lever clicks down. It’s ready for war.",
        "It’s surprisingly shiny for something so deadly."
    ],
    "Car": [
        "The engine revs menacingly.",
        "The headlights flash like angry eyes.",
        "You hear a faint 'beep beep' of pure hatred.",
        "Is that... a parking ticket under the wiper?"
    ],
    "Pizza": [
        "The cheese is bubbling with rage.",
        "A rogue pepperoni slice falls off like a scale.",
        "It’s extra crusty today.",
        "Pineapple on pizza? The ultimate enemy."
    ],
    "Bread": [
        "It’s a bit stale. This will be a tough fight.",
        "Gluten-filled and ready to rumble.",
        "A yeasty aroma fills the room.",
        "It's just loafing around."
    ],
    "Sofa": [
        "You feel like it wants to swallow you whole.",
        "A loose spring pokes out threateningly.",
        "You notice a remote controller inside it, that's where it went!",
        "It looks very comfortable, but stay alert!"
    ],
    "Toast": [
        "Golden brown and dangerous.",
        "It’s still warm... but its heart is cold.",
        "Butter slides off its surface like sweat.",
        "This toast is toast!"
    ],
    "Lamp": [
        "The light flickers in a Morse code of threats.",
        "It’s trying to brighten your day... literally to death.",
        "The bulb hums with electrical energy.",
        "A moth is circling it, confused by the battle."
    ],
    "Marshmallows": [
        "They look soft, but they have a sticky resolve.",
        "A giant puff of sugar blocks your path.",
        "They smell like a campfire and betrayal.",
        "Squishy... yet menacing."
    ]
}



def press_enter():
    print("\n\033[5m<Press enter to continue>\033[0m")
    input()

def typewriter(text, delay=0.02):
    for char in text:
        sys.stdout.write(char)
        sys.stdout.flush()
        time.sleep(delay)
    print() 

def format_damage(dmg, is_crit=False):
    if is_crit:
        return f"\033[5m{Color.YELLOW}★ {dmg} ★{Color.END}" # blinking yellow
    return f"{Color.RED}{dmg}{Color.END}"

def check_achievements():
    global achievements
    
    # Crumby Death - Tracking toaster encounters
    if toaster_encounters >= 5 and not achievements["Crumby Death"]:
        print(f"\n{Color.YELLOW}ACHIEVEMENT UNLOCKED: Crumby Death{Color.END}")
        achievements["Crumby Death"] = True

    # Bread Winner - If the score is high and you're in the food area
    if score >= 15 and "Pizza" in enemies and not achievements["Bread Winner"]:
        print(f"\n{Color.YELLOW}ACHIEVEMENT UNLOCKED: Bread Winner{Color.END}")
        achievements["Bread Winner"] = True

    # Hoarder - Check inventory length
    if len(inventory) >= 5 and not achievements["Hoarder"]:
        print(f"\n{Color.YELLOW}ACHIEVEMENT UNLOCKED: Hoarder{Color.END}")
        achievements["Hoarder"] = True

class Color:
    PURPLE = '\033[95m'
    CYAN = '\033[96m'
    DARKCYAN = '\033[36m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    END = '\033[0m'

# credit to AI to help search and find these


system_messages = [
    f"{Color.RED}[CRITICAL]: Brain.exe has stopped working. Please reboot user.{Color.END}",
    f"{Color.CYAN}[INFO]: I've seen better combat from a screensaver.{Color.END}",
    f"{Color.RED}[ERROR 418]: I'm a teapot, and even I fight better than you.{Color.END}",
    f"{Color.PURPLE}[SYSTEM]: Error 404 - Skill not found.{Color.END}",
    f"{Color.PURPLE}[SYSTEM]: Updating 'Days Since Last Embarrassment' to: 0.{Color.END}",
    f"{Color.YELLOW}[WARNING]: User coordination is below 1%. Is a cat walking on the keyboard?{Color.END}",
    f"{Color.BLUE}[SYNC]: Attempting to sync with player's brain... Error: No signal found.{Color.END}",
    f"{Color.RED}[FATAL]: Your combat logic is written in C- (C-Minus).{Color.END}",
    f"{Color.DARKCYAN}[SYSTEM]: Calculating win probability... [0.000001%]. So you're saying there's a chance?{Color.END}",
    f"{Color.GREEN}[LOG]: User used 'Stare Blankly'. It wasn't very effective.{Color.END}"
]



#  start

print("--- WELCOME ---")

name = input("Enter your name to play: ").strip()

if len(name) > 25:
    typewriter("You joking? What kind of name is that long?!?!")
    sys.exit()  

elif len(name) == 1:
    typewriter("A one-letter name? You're mysterious. I like it. Just kidding.")
    sys.exit()
elif name.isdigit():
    typewriter("Your name is a number? Are you a robot too?")
    sys.exit()

if name.lower() in ["poo", "poop", "poopy", "poopypants", "idiot", "butt", "moron"]:
    print("That is very immature!")
    sys.exit()

elif name == "":
    print("Well... You have to have a name!")
    sys.exit()

elif name.lower() == "jotham":
    typewriter("Oh, the advertiser! Welcome to the game you've been talking about.")
    typewriter("But are you really?")
elif name.lower() == "toaster":
    typewriter("Wait... you're a toaster? This is going to be awkward.")

elif name == "89Pexel":
    achievements["The 89Pexel Special"] = True
    typewriter("Are you kidding me?? Oh fine, I'll give you a chance.")
    typewriter("What is the passcode? (Totally not Letmein1)")
    passcode = input()
    if passcode == "OIOIOIGETMEIN":
        typewriter("Yes!! Amazing!!! How did you know??? Oh of course you are...")
        typewriter("That's wrong...")
        sys.exit()

    else:
        print("How did you know??? You must be a genius!")
        print("Or actually 89Pexel...")
        print("Please wait for your secret access... 3 seconds.")
        time.sleep(3)
        typewriter("Well I don't believe in you...")
        sys.exit()


typewriter(f"Thank you {name} for playing, I hope you enjoy this game!")

press_enter()

print("Please note that using certain terminals won't work with the blinking text, VS CODE's terminal won't show the blinking text,")
print("command prompt has a chance of working and not working, if it does work at first then it'll be fine for the rest of the time.")
typewriter("Thank you to 89Pexel for coding this game (myself). Thank you to Jotham for adding this and advertising this game.")
typewriter("Thank you for playing this game, I didn't make the enemies as thugs or some of you might get nightmares, just ask and I'll make a new version.")


# health

while hp > 0:
    current_enemy = random.choice(enemies)
    print(f"\n*** A wild {current_enemy} appeared! ***")

    if current_enemy == "Toaster":
        enemy_hp = random.randint(55, 80) + (level * 10)
        toaster_encounters += 1
    if current_enemy == "Bed":
        enemy_hp = random.randint(50, 65) + (level * 10)
    if current_enemy == "Sofa":
        enemy_hp = random.randint(60, 85) + (level * 10)
    if current_enemy == "Lamp":
        enemy_hp = random.randint(50, 70) + (level * 10)
    if current_enemy == "Car":
        enemy_hp = random.randint(60, 95) + (level * 10)
    if current_enemy == "Bread":
        enemy_hp = random.randint(75, 95) + (level * 10)
    if current_enemy == "Toast":
        enemy_hp = random.randint(80, 110) + (level * 10)
    if current_enemy == "Pizza":
        enemy_hp = random.randint(94, 130) + (level * 10)
    if current_enemy == "Marshmallows":
        enemy_hp = random.randint(94, 105) + (level * 10)
    if current_enemy == "Chair":
        enemy_hp = random.randint(100, 154) + (level * 20)
    if current_enemy == "Computer":
        enemy_hp = random.randint(110, 154) + (level * 25)
    if current_enemy == "Book":
        enemy_hp = random.randint(99, 120) + (level * 15)
    if current_enemy == "Cable":
        enemy_hp = random.randint(108, 129) + (level * 25)
    
    if current_enemy in flavor_text:
        print(f"{Color.CYAN}*{random.choice(flavor_text[current_enemy])}*{Color.END}")

# battle and actions
    
    while enemy_hp > 0 and hp > 0:
        print(f"\n[ {current_enemy}: {enemy_hp} HP ] | [ YOU: {hp} HP | Healers: {healers} ] | Level: {level}")
        choice = input(f"Actions: [1] Attack [2] Heal [3] Use Item [4] Inventory: ")


        if choice == "3":
            if not inventory:
                print("You have no items to use!")
                continue
            else:
                print(f"Available items: {inventory}")
                use_what = input("What do you want to use? ").strip()
                
                if use_what in inventory:
                    if use_what == "Lightbulb":
                        print("You threw a Lightbulb! The enemy is blinded! -25 enemy health!")
                        enemy_hp -= 25 * {level}
                        inventory.remove("Lightbulb")
                    elif use_what == "Spring":
                        print("You throw the spring... it bounces off the enemy's head. Boring. -2 enemy health...")
                        enemy_hp -= 2
                        inventory.remove("Spring")
                    elif use_what == "Pepperoni":
                        print("You throw the Pepperoni, it poisons the opponent! -30 enemy health!")
                        enemy_hp -= 30 * {level}
                        inventory.remove("Pepperoni")
                    elif use_what == "Dough":
                        print("You gain 3 healers!!!")
                        healers += 3
                        inventory.remove("Dough")
                    elif use_what == "Screw":
                        print("Are you sure? It will destroy the opponent immediately, best to save when your dying.")
                        print("Also, you can only gain this item once, which is the one you have right now.")
                        print("Press 1 to use, press anything else to cancel.")
                        screw_choice = input(">> ")
                        if screw_choice == "1":
                            print("1000000 damage to opponent!")
                            enemy_hp -= 1000000 
                            inventory.remove("Screw")
                    elif use_what == "Metal":
                        typewriter("It explodes!")
                        typewriter("You found a 'Shard'!")
                        inventory.remove("Metal")
                        inventory.append("Shard")
                    elif use_what == "Shard":
                        typewriter("+50 health!!!!")
                        hp += 50
                        inventory.remove("Shard")
                        
                else:
                    print("You aren't carrying that!")
               

        elif choice == "4":
            print("\n--- INVENTORY ---")
            if not inventory:
                print("Your pockets are empty...")
            else:
                for item in set(inventory):
                    print(f"- {item} (x{inventory.count(item)})")
            print("-----------------")
            continue

      
        elif choice == "2":
            if healers > 0:
                hp += 25
                healers -= 1
                continue
            else: 
                typewriter("No healers left!")
                continue
        if current_enemy == "Toaster":
            if choice == "1":
                dmg = random.randint(10, 15) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                hp -= 5 
                typewriter(f"You punch the metal! {format_damage(dmg)} dmg to it, 5 dmg to you.")


        
        elif current_enemy == "Bed":
            if choice == "1":
                dmg = random.randint(5, 13) + (level * 2)

                if random.random() < 0.2: 
                    dmg = dmg * 2
                    typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")


                enemy_hp -= dmg
                typewriter(f"You unscrew the bed! {format_damage(dmg)} dmg to it!")


        
        elif current_enemy == "Sofa":
            if choice == "1":
                dmg = random.randint(8, 12) + (level * 2)

                if random.random() < 0.2:
                    dmg = dmg * 2
                    typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                hp += 2 
                typewriter(f"Soft punch! {format_damage(dmg)} dmg. The cushions heal you +2 HP. Lower damage due to the cushions.")



        
        elif current_enemy == "Lamp":
            if choice == "1":
                dmg = random.randint(5, 17) + (level * 2)

                if random.random() < 0.2:
                    dmg = dmg * 2
                    typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You smash the bulb! {format_damage(dmg)} dmg to it.")


        if current_enemy == "Car":
            if choice == "1":
                dmg = random.randint(10, 25) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                hp -= 7 
                typewriter(f"You punch the metal! {format_damage(dmg)} dmg to it, 7 dmg to you, OUCH!")

        if current_enemy == "Bread":
            if choice == "1":
                dmg = random.randint(10, 27) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                hp -= 5
                typewriter(f"You punch the bread! {format_damage(dmg)} dmg to it, for some reason you lost 5 health...")



        if current_enemy == "Toast":
            if choice == "1":
                dmg = random.randint(5, 20) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                hp += 5
                typewriter(f"You eat the toast! {format_damage(dmg)} dmg to it, and +5 health, delicious!")

        if current_enemy == "Pizza":
            if choice == "1":
                dmg = random.randint(5, 25) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You tell it pinapple doesn't go on pizza. {format_damage(dmg)} dmg to it!")

        if current_enemy == "Marshmallows":
            if choice == "1":
                dmg = random.randint(10, 27) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You eat the marshmallow. {format_damage(dmg)} dmg to it!")


        if current_enemy == "Chair":
            if choice == "1":
                dmg = random.randint(15, 23) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You smash the chair! {format_damage(dmg)} dmg to it! -5 health to you.")
                hp -= 5


        if current_enemy == "Computer":
            if choice == "1":
                dmg = random.randint(12, 19) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You smash the computer! {format_damage(dmg)} dmg to it! Glass shards hit you! -7 health to you.")
                hp -= 7

        if current_enemy == "Book":
            if choice == "1":
                dmg = random.randint(12, 13) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You smash the book! {format_damage(dmg)} dmg to it!")

        if current_enemy == "Cable":
            if choice == "1":
                dmg = random.randint(12, 19) + (level * 2)

                if random.random() < 0.2: 
                   dmg = dmg * 2
                   typewriter(f"{Color.RED}CRITICAL HIT!{Color.END}")

                enemy_hp -= dmg
                typewriter(f"You cut the wire! {format_damage(dmg)} dmg to it!")



            
        if random.random() < 0.2:
           typewriter("\n" + random.choice(system_messages))
           

        if hp < 50 and random.random() < 0.3:
            typewriter(f"{Color.RED}[SYSTEM]: Critical failure imminent. Have you tried NOT dying?{Color.END}")


            
# damage 

        
        if enemy_hp > 0 and hp > 0:
            if random.random() < 0.20:
                print(f"The {current_enemy} tried to hit you but MISSED!")
            else:
                if current_enemy == "Toaster":
                    e_dmg = random.randint(5, 17)
                    hp -= e_dmg
                    print(f"The {current_enemy} sends toasts in your eyes back for {e_dmg}!")
                if current_enemy == "Bed":
                    e_dmg = random.randint(4, 20)
                    hp -= e_dmg
                    print(f"The {current_enemy} hits you back for {e_dmg}!")
                if current_enemy == "Sofa":
                    e_dmg = random.randint(4, 15)
                    hp -= e_dmg
                    print(f"The {current_enemy} goes on you for {e_dmg}!")
                if current_enemy == "Lamp":
                    e_dmg = random.randint(5, 18)
                    hp -= e_dmg
                    print(f"The {current_enemy} hits back for {e_dmg}!")
                if current_enemy == "Car":
                    e_dmg = random.randint(7, 20)
                    hp -= e_dmg
                    print(f"The {current_enemy} drives on you for {e_dmg}!")
                if current_enemy == "Bread":
                    e_dmg = random.randint(7, 22)
                    hp -= e_dmg
                    print(f"The {current_enemy} hits you back for {e_dmg}!")
                if current_enemy == "Toast":
                    e_dmg = random.randint(5, 17)
                    hp -= e_dmg
                    print(f"The {current_enemy} burns you back for {e_dmg}!")
                if current_enemy == "Pizza":
                    e_dmg = random.randint(7, 15)
                    hp -= e_dmg
                    print(f"The {current_enemy} burns you back for {e_dmg}!")
                if current_enemy == "Marshmallows":
                    e_dmg = random.randint(8, 23)
                    hp -= e_dmg
                    print(f"The {current_enemy} burns you back for {e_dmg}!")
                if current_enemy == "Chair":
                    e_dmg = random.randint(5, 27)
                    hp -= e_dmg
                    print(f"The {current_enemy} falls on you for {e_dmg}!")
                if current_enemy == "Computer":
                    e_dmg = random.randint(10, 32)
                    hp -= e_dmg
                    print(f"The {current_enemy} shards you back for {e_dmg}!")
                if current_enemy == "Book":
                    e_dmg = random.randint(15, 21)
                    hp -= e_dmg
                    print(f"The {current_enemy} gives you a papercut back for {e_dmg}!")
                if current_enemy == "Cable":
                    e_dmg = random.randint(19, 37)
                    hp -= e_dmg
                    print(f"The {current_enemy} zaps you back for {e_dmg}!")
# win and drops
    
    if hp > 0:
        score += 1
        print(f"\n--- {random.choice(victory_messages)} ---")
        print(f"Total enemies defeated so far: {score}")


        check_achievements()
        

        if spring == False:
            if current_enemy == "Toaster":
                if random.random() < 0.3:
                    print("You find a 'Spring' inside the Toaster!")
                    inventory.append("Spring")
                    spring = True
        
        if spring == True:
            print(f"\nTo exchange for 1 healer press 1")
            choice = input(">> ")
            
            if choice == "1":
                inventory.remove("Spring")
                healers += 1
                spring = False
                print("You used the spring to get a healer! (+1 Healer)")

        if current_enemy == "Lamp":
            if random.random() < 0.3:
                print("The Lamp dropped a 'Lightbulb'!")
                inventory.append("Lightbulb")
        
        if current_enemy == "Pizza":
            if random.random() < 0.3:
                print("The pizza dropped a 'Pepperoni'!")
                inventory.append("Pepperoni")
        
        if current_enemy == "Bread":
            if random.random() < 0.07:
                print("The bread dropped 'Dough'!")
                inventory.append("Dough")
        
        if current_enemy == "Car" and not onlyonce:
            if random.random() < 0.7:
                print("The car dropped a 'Screw'!")
                inventory.append("Screw")
                onlyonce = True
        
        if current_enemy == "Computer":
            if random.random() < 0.1:
                print("The computer dropped a 'Shard'!")
                inventory.append("Shard")
                
# prompts and levels  



        if done == True:
            print()

        elif done == False:
            if score == 1:

               typewriter(f"\n{name}: I bought too much furniture...")

               press_enter()

               done = True
        
        if score == 5:
            
            press_enter()

            typewriter(f"{name}: Why did I buy so much toasters?")
            typewriter("Your skill level is now 1!")
            typewriter("+3 healers!")

            press_enter()
            level = 1
            healers += 3
            

        if score == 7:

            press_enter()

            print(f"{name}: I guess I went on a 24 hour shopping spree...")

            press_enter()

        if score == 9:

            press_enter()

            print(f"{name}: Am I really that rich to have that much cars?")

            press_enter()

        if score == 10:
            typewriter("Next area!!! Food!")
            typewriter("Your health is 350 and you have gotten +5 healers!")

            press_enter()

            enemies = ["Bread", "Toast", "Pizza", "Marshmallows"]
            hp = 350
            healers += 5
        
        if score == 12:

            press_enter()
            
            typewriter("Who bought so much food? (Next level at 23 kills)")

            press_enter()
        
        if score == 23:

            press_enter()

            typewriter("Your new skill level is 2")

            level = 2
        
        if score == 30:

            press_enter()

            print("Area 3!")
            typewriter("Office")
            typewriter("Your new skill level is 3")
            typewriter("+3 healers")
            typewriter("+500 health")

            level = 3
            healers +=3
            health += 500
            enemies = ["Chair", "Computer", "Book", "Cable"]

            press_enter()

        if score == 5:
            if single == False:
                typewriter("You find metal, its weird shaped...")
                print("You found 'Metal'!")
                inventory.append("Metal")
                single = True
            elif single == True:
                print()

        
        if score == 1 or score == 3 or score == 4:
            current_enemy = "Toaster"

# healers
        
        
        if random.random() < 0.3:
            healers += 1
            messages = [
            "You squint your eyes as you see something unusual... It's a healer in the wreckage!",
            "You feel like you spotted something off. Then you realise its a healer!",
            "You search the wreckage for any valuable things, you find a healer!",
            "You see a glimmer of something... Oh... It's a healer!",
            "What's that? Interesting, wait a second... It's a healer!"
            ]
            print(random.choice(messages))
# loss      
    else:
        if score >= 11:
            print(f"\n--- You lose ---")
            print(f"Final Score: {score} enemies defeated.")
            print("You have beaten over 10 enemies. Congratulations!")
            print("Amazing!")
        else:
            print(f"\n--- You lose ---")    
            print(f"Final Score: {score} enemies defeated.")
            print("Nice!")

        
        print("\n--- ACHIEVEMENTS EARNED ---")
        earned = [name for name, status in achievements.items() if status]
        if earned:
            for a in earned:
                print(f"- {a}")
        else:
            print("No achievements... yet. Keep fighting the furniture!")
